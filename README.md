# Расчёт метрик платформы для решения задач с целью создания плана смены монетизации
## Описание задачи
Сейчас, по сути, платформа бесплатная. В ней есть внутренняя валюта, но мало кто ее покупает. Смысл такой - за активность на платформе пользователи получают монеты, также они могут их купить за деньги. А потратить они их могут, чтобы открыть премиальные задачи, тесты, подсказки и решения.
У внутренней валюты есть несколько существенных недостатков:
- Ее сложно продавать - практически никакой рекламной стимуляции валюта не подвергается
- На нее сложно делать акции
- Большинство людей покупает маленькие пакеты монет (да и сами пакеты недорогие)
- Человек может единоразово купить монет и ему хватит надолго
  
Пока платформа молодая и находится на стадии роста, компания планирует внедрить стандартную подписочную модель.

Для определеня, что будет входить в подписку, мне поручено посчитать следующие основные метрики, которые помогут принять решение:
- Метрика n-day retention.
- Метрика rolling retention.
- Среднее и медианное число решаемых задач и тестов.
- Сколько монет в среднем списывает пользователь за весь срок жизни? Сколько монет ему начисляется? Какая дельта между этими двумя метриками?
- Распределение итогового баланса пользователей по перцентилям.
- % сессий, не сопровождающихся активностью.
- Метрика MAU.

## Исходные дынные
Данные для подключения к базе данных:
```
Хост: 95.163.241.236
Порт: 5432
База данных: simulative
Юзер: student
Пароль: qweasd963
```
[Структура таблиц](https://docs.google.com/document/d/1TwZXkZZVGD7fk-6wTeVoZykTGw7ovObWnEEvH2kLfxM/edit)

## Распределение числа решенных задач и тестов

Задача посчитать:

- сколько в среднем задач решает один пользователь (пусть даже неправильно, но хотя бы делает попытку)
- сколько в среднем тестов начинает проходить один пользователь (пусть даже не заканчивает)

### Код

Код для решения задачи его описание можно посмотреть [здесь](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/Распределение%20числа%20решенных%20задач%20и%20тестов.sql)

### Результат выполнения запроса

![Результат выполнения запроса](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/tests%20and%20problems%20result.JPG)

## Распределение списаний и начислений

Задача посчитать:

- Сколько монет в среднем пользователь списывает за весь срок жизни?
- Сколько монет в среднем пользователю начисляется за весь срок жизни?
- Какая в среднем разница между этими двумя числами?

### Код

Код для решения задачи его описание можно посмотреть [здесь](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/Распределение%20списаний%20и%20начислений.sql)

### Результат выполнения запроса

![Результат выполнения запроса](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/write_off%2C%20accurals%2C%20balance%20result.JPG)

## Распределение баланса пользователей
У одного пользователя может быть много транзакций. В фиксированный момент времени у него есть некий баланс.
Необходимо посчитать баланс каждого пользователя и найти распределение баланса по перцентилям с шагом 0.1.

### Код

Код для решения задачи его описание можно посмотреть [здесь](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/Распределение%20баланса%20пользователей.sql)

### Результат выполнения запроса

![Результат выполнения запроса](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/perc%20balanse%20result.JPG)

## % сессий, не сопровождающихся активностью

Необходимо ответить на вопрос: какой процент заходов на платформу не сопровождается активностью? То есть надо посчитать % визитов, в которых человек зашел на платформу, но не проявил активность за этот же день.

### Код

Код для решения задачи его описание можно посмотреть [здесь](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/Неактивные%20сессии.sql)

### Результат выполнения запроса

В результате выполнения запроса узнаём, что 53.36% заходов на платформу не сопровождается какой либо активностью.

## Расчет MAU.

Задача: написать запрос для расчета MAU на основании заходов пользователей на платформу. Учитываем только месяцы, в которые были заходы на платформу в течение 25 или более дней (не обязательно подряд).

### Код

```
-- сначала считаем количесвто уникальных пользователей по месяцам и фильтруем
with cnt_users_month as
	(select count(distinct user_id) cnt_user_id, 
			to_char(u.entry_at, 'YYYY-MM') date
	from userentry u
	group by date 
	having count(distinct u.entry_at::date) > 24)
-- находим средннее значение
select round(avg(cnt_user_id))
from cnt_users_month 
```

### Результат выполнения запроса

В результате выполнения запроса узнаём, что в среднем на нашу платформу заходят 524 уникальных пользователя в месяц.

## Расчет n-day retention.

В рамках исследования с целью смены модели монетизации на платформе нам очень интересно посчитать метрику - классический n-day retention. Это поможет лучше понять активность пользователей и ответить на многие вопросы. Например:

- Нужно ли вводить бесплатный период или пользователи в целом довольно быстро уходят с платформы?
- Какое сейчас значение ретеншен и насколько сильно нам его нужно повышать, чтобы хотя бы несколько месяцев получать деньги за подписку?
- На какой день основная масса людей отваливается?

Нас интересуют конкретные N-дни (по сути, это самые распространенные отсечки времени на практике): 0, 1, 3, 7, 14, 30, 60 и 90 дня. У нас не так много данных, поэтому ограничимся кварталом

Пользователей разобьем по когортам. Когорты при расчете retention формируем по месяцам регистрации пользователей и только начиная с 2022 года.

### Код

Код для решения задачи его описание можно посмотреть [здесь](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/n-day%20retention.sql)

### Результат выполнения запроса

![Результат выполнения запроса (результаты оформлены в Metabase для наглядности)](https://github.com/TrofimovIA/Monetization-Analytics/blob/main/metabase_nday_retention.JPG)

Метрика n-day retention - не самая показательная, т.к. человек мог не прийти на 5 день после регистрации, но мог прийти на 6 или на 8. И это не значат, что мы его потеряли. Поэтому в нашем случае намного лучше считать rolling retention.



